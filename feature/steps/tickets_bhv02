# -*- coding: utf-8 -*-
import random
import time
from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from behave import *

#Регистрация уже имеющегося пользователя
@given('website "https://dev.ticketscloud.org" and click "Зарегистрироваться"')
def step(context):
    context.driver = webdriver.Firefox()
    context.driver.get('https://stage.ticketscloud.org/#/')
    button_reg = context.driver.find_element_by_xpath('//a[@href="#/register"]')
    button_reg.click()
    assert 'Tickets Cloud' in context.driver.title

@then('whrite in field name and assert button disabled')
def step(context):
    elem_name = context.driver.find_element_by_id('name')
    elem_name.send_keys('Vlad')
    assert context.driver.find_element_by_xpath('//input[@disabled="disabled"]')

@then('whrite in field mobile and assert button disabled')
def step(context):
    elem_phone = context.driver.find_element_by_id('mobile')
    elem_phone.send_keys('+79189145456')
    assert context.driver.find_element_by_xpath('//input[@disabled="disabled"]')

@then('whrite in field email invalid value and assert warning')
def step(context):
    elem_email = context.driver.find_element_by_id('email')
    elem_email.send_keys('abc_cba07')
    assert context.driver.find_element_by_class_name('ng-invalid-pattern')

@then('whrite in field email valid value and assert button disabled')
def step(context):
    elem_email = context.driver.find_element_by_id('email')
    elem_email.send_keys('@mail.ru')
    assert context.driver.find_element_by_xpath('//input[@disabled="disabled"]')

@then('write in feald password invalid value and assert warning')
def step(context):
    elem_pass = context.driver.find_element_by_id('password')
    elem_pass.send_keys('bddt')
    assert context.driver.find_element_by_class_name('ng-invalid-pattern')

@then('whrite in field valid password')
def step(context):
    elem_pass = context.driver.find_element_by_id('password')
    elem_pass.send_keys('est01')

@then('select "Я - Организатор"')
def step(context):
    elem_select = context.driver.find_element_by_xpath('//input[@id="i-am-org"]')
    elem_select.click()

@then('push button and wait to get page source')
def step(context):
    elem_subm = context.driver.find_element_by_id('submit')
    elem_subm.click()
    time.sleep(0.5)

@then('page include text "Пользователь abc_cba07@mail.ru уже существует"')
def step(context):
    assert 'Пользователь abc_cba07@mail.ru уже существует' in context.driver.page_source
    context.driver.close()

@then('whrite in field email new email')
def step(context):
    elem_email = context.driver.find_element_by_id('email')
    elem_email.clear()
    rand = random.randint(1,999999)
    elem_email.send_keys('abc_cba' + str(rand) + '@mail.ru')

@then('page include text "Заполните реквизиты"')
def step(context):
    assert 'Заполните реквизиты' in context.driver.page_source
    context.driver.close()

@then('click button "Индивидуальный предприниматель" in Personal Area')
def step(context):
    elem_ip = context.driver.find_element_by_xpath('//div[@class="tc-form__row"]/button[1]')
    elem_ip.click()
    assert 'Адрес регистрации' in context.driver.page_source

@then ('write in field "ФИО ПОЛНОСТЬЮ" and assert filling important fields')
def step(context):
    elem_fio = context.driver.find_element_by_xpath('//input[@ng-model="legalEdit.legal.detail.name"]')
    elem_fio.send_keys('Иванов Иван Иванович')

@then ('write in field "АДРЕС РЕГИСТРАЦИИ" and assert filling important fields')
def step(context):
    elem_address = context.driver.find_element_by_xpath('//input[@ng-model="legalEdit.legal.detail.address"]')
    elem_address.send_keys('г. Москва ул. Пушкина')

@then ('write in field "ОГРНИП" and assert filling important fields')
def step(context):
    elem_ogrnip = context.driver.find_element_by_xpath('//input[@ng-model="legalEdit.legal.detail.ogrnip"]')
    elem_ogrnip.send_keys('121232324565456')

@then ('write in field "ИНН" and assert filling important fields')
def step(context):
    elem_inn = context.driver.find_element_by_xpath('//input[@ng-model="legalEdit.legal.detail.inn"]')
    elem_inn.send_keys('565489654878')

@then ('choose value of "ХОЧУ ПОЛУЧАТЬ ПЛАТЕЖИ"')
def step(contex):
    lem_tax = context.driver.find_element_by_xpath('//div[@ng-model="legalEdit.legal.detail.taxes"]').click()
    elem_ob = context.driver.find_element_by_id('ui-select-choices-row-1-0').click()
    elem_tax = context.driver.find_element_by_xpath('//div[@ng-model="legalEdit.legal.detail.taxes"]').click()
    elem_upr = context.driver.find_element_by_id('ui-select-choices-row-1-1').click()

@then ('choose value of "СИСТЕМА НАЛОГООБЛАЖЕНИЯ"')
def step(context):
    lem_tax = context.driver.find_element_by_xpath('//div[@ng-model="legalEdit.legal.detail.taxes"]').click()
    elem_ob = context.driver.find_element_by_id('ui-select-choices-row-1-0').click()
    elem_tax = context.driver.find_element_by_xpath('//div[@ng-model="legalEdit.legal.detail.taxes"]').click()
    elem_upr = context.driver.find_element_by_id('ui-select-choices-row-1-1').click()

@then ('write in field "НАЗВАНИЕ БАНКА" and assert filling important fields')
def step(context):
    elem_bank = contex.driver.find_element_by_id('bank_name')
    elem_bank.send_keys('Первый Межгалактический')

@then ('write in field "БИК" and assert filling important fields')
def step(context):
    elem_bik = context.driver.find_element_by_id('bik')
    elem_bik.send_keys('254648978')

@then ('write in field "КОРР.СЧЕТ" and assert filling important fields')
def step(context):
    elem_ks = context.driver.find_element_by_id('ks')
    elem_ks.send_keys('85456320000120045630')

@then('write in field "РАСЧЕТНЫЙ СЧЕТ" and assert filling important fields')
def step(contex):
    elem_rs = context.driver.find_element_by_id('rs')
    elem_rs.submit()
    assert context.driver.find_element_by_class_name('ng-invalid-required')
    elem_rs.send_keys('10000155038017705620')
    elem_address.submit()
    assert context.driver.find_element_by_class_name('ng-invalid-required')

@then('click on "Согласен с Лицензионным договором"')
def step(contex):
    elem_license = context.driver.find_element_by_id('license_agreement')
    elem_license.click()

@then('click submit')
def step(contex):
    elem_license.submit()
    time.sleep(1)